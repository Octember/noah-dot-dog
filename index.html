<html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/canvas.css">


    <link href="images/favicon.ico" rel="icon" type="image/x-icon" />
</head>

<body>
<canvas id="canvas"></canvas>

</body>

<script>
var CANVAS_WIDTH;
var CANVAS_HEIGHT;
var SPEED         = 6;
var MAX_SPEED     = 20;
var MAX_DOGE      = 5;
var DOGE_SIZE     = 150;
var FOOD_SIZE     = 75;

var doges  = [];
var foods  = [];

var canvasElement = document.getElementById('canvas');
var context   = canvasElement.getContext('2d');
CANVAS_WIDTH  = context.canvas.width  = window.innerWidth;
CANVAS_HEIGHT = context.canvas.height = window.innerHeight;

var dogeImage  = new Image(); // HTML5 Constructor
var breadImage = new Image();
dogeImage.src  = 'images/doge.png';
breadImage.src = 'images/bread.png';


var keyStates = {};

document.addEventListener('keydown', function(event) {
    keyStates[event.keyCode] = true;
}, true);
document.addEventListener('keyup', function(event) {
    keyStates[event.keyCode] = false;
}, true);

var FPS = 30;
setInterval(function() {
  update();
  draw();
}, 1000/FPS);

setInterval(function() {
  spawnFood();
}, 3000);

function spawnFood() {
    var x = 50 + (Math.random() * CANVAS_WIDTH) - 100;
    var y = 50 + (Math.random() * CANVAS_HEIGHT) - 100;

    foods.push([x, y]);
}

var player = {
  color: "#00A",
  x: 220,
  y: 270,
  dx: 2,
  dy: -2,
  width: 32,
  height: 32,
  draw: function() {
    context.fillStyle = this.color;
    context.drawImage(doge, this.x, this.y);
  },
  update: function() {
    var dx = 0,
        dy = 0;
    if (keyStates[37] || keyStates[65]) {
        // Left or A
        dx = -SPEED;
    } else if (keyStates[39] || keyStates[68]) {
        // right or D
        dx = SPEED;
    }

    if (keyStates[38] || keyStates[87]) {
        dy = -SPEED;
    } else if (keyStates[40] || keyStates[83]) {
        dy = SPEED;
    }

    var totalSpeed = Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2));
    dx = totalSpeed == 0 ? 0 : dx * SPEED / totalSpeed;
    dy = totalSpeed == 0 ? 0 : dy * SPEED / totalSpeed;

    player.dx += dx;
    player.dy += dy;

    if (player.x + player.dx < -100) {
        player.dx *= -0.5;
        player.x   = -100;
    } else if (player.x + player.dx > CANVAS_WIDTH - 100) {
        player.dx *= -0.5;
        player.x   = CANVAS_WIDTH - 100;
    } else {
        player.x += player.dx;
    }

    if (player.y + player.dy < -100) {
        player.dy *= -0.5;
        player.y   = -100;
    } else if (player.y + player.dy > CANVAS_HEIGHT - 100) {
        // player.dy *= -0.5;
        // player.y   = CANVAS_HEIGHT - 100;


        player.y = 250;
        player.y = -100;
    } else {
        player.y += player.dy;
    }

    doges.push([player.x, player.y]);
  },

    intersect: function(food) {
        var r1 = DOGE_SIZE / 2;
        var r2 = DOGE_SIZE / 2;

        var dx = Math.pow(player.x - food[0], 2);
        var dy = Math.pow(player.y - food[1], 2);

        var distance = Math.sqrt(dx + dy);

        return distance + 40 < r1 + r2;
    }
};

function update() {
    player.update();

    if (doges.length == MAX_DOGE) {
        doges.shift();
    }

    // check intersections
    for (var i = 0; i < foods.length; i++) {
        if (player.intersect(foods[i])) {
            foods.splice(i, 1);
            MAX_DOGE += 10;
            break;
        }
    }
}

function draw() {
    context.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
    for (var i = 0; i < doges.length; i++) {
        var coords = doges[i];
        context.drawImage(dogeImage, coords[0], coords[1], DOGE_SIZE, DOGE_SIZE);
        context.fillStyle = "green";
    }
    // context.fillRect(player.x + (DOGE_SIZE / 2), player.y + (DOGE_SIZE / 2), 5, 5);

    for (var i = 0; i < foods.length; i++) {
        var coords = foods[i];
        context.drawImage(breadImage, coords[0], coords[1], FOOD_SIZE, FOOD_SIZE);
    }


}

</script>

</html>
